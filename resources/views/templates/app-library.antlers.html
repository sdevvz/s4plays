{{# Page Header #}}
<section class="relative pt-32 pb-16 bg-gradient-to-br from-orange-50 to-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-4">
                {{ title ?? 'App Library' }}
            </h1>
            {{ if content }}
            <div class="text-lg text-gray-600 max-w-2xl mx-auto prose prose-lg">
                {{ content }}
            </div>
            {{ else }}
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Browse our complete collection of premium apps and modded games
            </p>
            {{ /if }}
            
            {{# Stats Bar #}}
            <div class="mt-8 flex flex-wrap justify-center gap-8">
                <div>
                    <div class="text-2xl font-bold text-orange-600">{{ collection:apps count="true" }}</div>
                    <div class="text-sm text-gray-500">Total Apps</div>
                </div>
                <div>
                    <div class="text-2xl font-bold text-orange-600">{{ taxonomy:categories count="true" }}</div>
                    <div class="text-sm text-gray-500">Categories</div>
                </div>

            </div>
        </div>
    </div>
</section>

{{# Filters & Search Section #}}
<section class="py-12 bg-white border-b border-gray-100 sticky top-16 z-30">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row gap-4 items-center justify-between">
            {{# Search Bar #}}
            <div class="w-full lg:w-2/3">
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <i class="fa-solid fa-search text-gray-400 group-focus-within:text-orange-500"></i>
                    </div>
                    <input type="text" 
                           id="app-search" 
                           class="block w-full pl-12 pr-4 py-3 border border-gray-200 rounded-xl leading-5 bg-gray-50 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 focus:bg-white transition" 
                           placeholder="Search by app name, category, or feature...">
                </div>
            </div>
            
            {{# Sort & Filter #}}
            <div class="w-full lg:w-1/3 flex gap-2">
                <select id="sort-select" class="flex-1 px-4 py-3 border border-gray-200 rounded-xl bg-gray-50 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition">
                    <option value="name">Sort by Name</option>
                    <option value="rating">Sort by Rating</option>
                    <option value="downloads">Sort by Downloads</option>
                    <option value="recent">Recently Added</option>
                </select>
            </div>
        </div>
    </div>
</section>

{{# Category Tabs #}}
<section class="py-8 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-wrap gap-3">
            <button class="category-filter active px-6 py-2.5 rounded-xl text-sm font-semibold bg-orange-500 text-white shadow-md transition transform hover:scale-105" data-category="all">
                <i class="fa-solid fa-grip mr-2"></i> All Apps
            </button>
            {{ taxonomy:categories }}
                <button class="category-filter px-6 py-2.5 rounded-xl text-sm font-semibold bg-white text-gray-700 border-2 border-gray-200 hover:border-orange-500 hover:text-orange-500 transition" data-category="{{ slug }}">
                    <i class="{{ icon ?? 'fa-solid fa-folder' }} mr-2"></i> {{ title }}
                </button>
            {{ /taxonomy:categories }}
        </div>
    </div>
</section>

{{# Apps Grid #}}
<section class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {{# Loading State #}}
        <div id="loading-state" class="hidden text-center py-12">
            <div class="inline-block w-12 h-12 border-4 border-orange-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="mt-4 text-gray-600">Loading apps...</p>
        </div>
        
        {{# Apps Grid #}}
        <div id="apps-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            {{ collection:apps sort="title:asc" }}
                {{ partial:partials/_app-card }}
            {{ /collection:apps }}
        </div>
        
        {{# Empty State #}}
        <div id="empty-state" class="hidden text-center py-16">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
                <i class="fa-solid fa-search text-4xl text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">No apps found</h3>
            <p class="text-gray-600 mb-6">Try adjusting your search or filter criteria</p>
            <button onclick="resetFilters()" class="px-6 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition">
                Reset Filters
            </button>
        </div>
        
        {{# Results Count #}}
        <div class="mt-8 text-center text-sm text-gray-500">
            Showing <span id="results-count">{{ collection:apps count="true" }}</span> apps
        </div>
    </div>
</section>

{{# JavaScript #}}
{{ section:extra_scripts }}
<script>
    // App Library Interactive Features
    const searchInput = document.getElementById('app-search');
    const sortSelect = document.getElementById('sort-select');
    const categoryFilters = document.querySelectorAll('.category-filter');
    const appsGrid = document.getElementById('apps-grid');
    const emptyState = document.getElementById('empty-state');
    const resultsCount = document.getElementById('results-count');
    
    let currentCategory = 'all';
    let currentSort = 'name';
    
    // Search functionality
    searchInput.addEventListener('input', filterApps);
    sortSelect.addEventListener('change', (e) => {
        currentSort = e.target.value;
        filterApps();
    });
    
    // Category filtering
    categoryFilters.forEach(btn => {
        btn.addEventListener('click', () => {
            // Update active state
            categoryFilters.forEach(b => {
                b.classList.remove('bg-orange-500', 'text-white', 'shadow-md', 'scale-105', 'active');
                b.classList.add('bg-white', 'text-gray-700', 'border-2', 'border-gray-200');
            });
            btn.classList.add('bg-orange-500', 'text-white', 'shadow-md', 'active');
            btn.classList.remove('bg-white', 'text-gray-700', 'border-2', 'border-gray-200');
            
            currentCategory = btn.getAttribute('data-category');
            filterApps();
        });
    });
    
    function filterApps() {
        const searchTerm = searchInput.value.toLowerCase();
        const cards = appsGrid.querySelectorAll('.glass-card');
        let visibleCount = 0;
        
        cards.forEach(card => {
            const title = card.querySelector('h3').innerText.toLowerCase();
            const description = card.querySelector('p').innerText.toLowerCase();
            const category = card.getAttribute('data-category');
            
            const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
            const matchesCategory = currentCategory === 'all' || category === currentCategory;
            
            if (matchesSearch && matchesCategory) {
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.style.display = 'none';
            }
        });
        
        // Update results count
        resultsCount.textContent = visibleCount;
        
        // Show/hide empty state
        if (visibleCount === 0) {
            emptyState.classList.remove('hidden');
        } else {
            emptyState.classList.add('hidden');
        }
    }
    
    function resetFilters() {
        searchInput.value = '';
        sortSelect.value = 'name';
        currentCategory = 'all';
        
        // Reset category buttons
        categoryFilters.forEach(b => {
            b.classList.remove('bg-orange-500', 'text-white', 'shadow-md', 'active');
            b.classList.add('bg-white', 'text-gray-700');
        });
        categoryFilters[0].classList.add('bg-orange-500', 'text-white', 'shadow-md', 'active');
        categoryFilters[0].classList.remove('bg-white', 'text-gray-700');
        
        filterApps();
    }
    
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
</script>
{{ /section:extra_scripts }}